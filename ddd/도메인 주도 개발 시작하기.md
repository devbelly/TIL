<p align="center">
  <img src="https://github.com/devbelly/TIL/assets/67682840/0b619ae5-6e47-4736-8107-b4966eb7871d">
</p>

# 1. 도메인 모델 시작하기

## 1.1 도메인이란?

> [!info] 도메인이란?
> - 소프트웨어로 해결하고자 하는 문제영역을 의미한다.

- 도메인은 하위 도메인으로 나뉠 수 있다.
	- 쇼핑몰이라는 큰 도메인은 결제, 정산, 배송, 할인 등 하위 도메인으로 나눌 수 있다.
- 하나의 도메인에서 모두 처리하기 보단 외부 시스템과 연계할 수도 있다.

## 1.2 도메인 전문가와 개발자와의 대화

- 각 도메인 전문가마다 자신의 경험치를 토대로 요구사항을 말한다.
	- 회계사는 엑셀에 있는 내용을 특정 방식으로 자동화
	- AS기사는 사용자에게 보낼 내용에 대한 템플릿 생성
- 요구사항은 첫단추와 같아 항상 자세히 분석해야한다.
	- 도메인 전문가와 개발자 사이에 많은 사람이 개입한다면 요구사항이 변질될 가능성이 높다.

## 1.3 도메인 모델

> [!info] 도메인 모델이란?
> - 도메인을 이해하기 위해 개념적으로 표현한 것.

- 도메인 모델을 표현할 때는 다양한 방법을 사용할 수 있다.
	- 객체 모델
	- 그래프
	- 다이어그램
- 도메인 모델을 구현하기 위한 물리 모델은 최대한 표현 방식을 따를 수 있다.
	- 객체 모델을 선택했다면 객체지향적인 언어를 선택
	- 수학적인 모델을 선택했다면 함수형 언어를 선택

## 1.4 도메인 모델 패턴

- 아키텍쳐에서 도메인 계층을 구현할 때 객체지향적으로 도메인을 설계하는 것을 도메인 모델 패턴이라고 한다.
- 도메인 계층에는 도메인의 핵심 규칙을 구현한다.
	- 주문 도메인의 핵심 규칙
		- 출고전에는 배송지를 변경할 수 있다.
		- 배송시작전이라면 주문을 취소할 수 있다.
		- etc
- 핵심규칙(예를 들어 배송지 변경)이 `Order.class`에 속하든 `OrderState.class`에 속하는지 상관없이 도메인 모델 내애 속해있으면…
	- 변경 시 다른 코드에 영향을 덜 준다.

> [!info] 도메인 모델?
> - 도메인을 개념적으로 표현할때 도메인 모델이라는 표현을 사용
> - 도메인 계층을 표현한 객체 모델을 언급할때도 도메인 모델이라는 표현을 사용

## 1.5 도메인 모델 도출

- 도메인을 구성하는 핵심요소, 규칙, 기능을 파악하는 것에서 출발한다.
	- 위 내용의 기초가 되는 것은 요구사항을 분석
- 한 상품을 한개 이상 주문할 수 있다 + 각 상품의 구매 가격 합은 상품 가격에 갯수를 곱한 값이다.
	- OrderLine에는 `Product`, `amount`, `price` 가 핵심 요소이다.
	- OrderLine에는 `getTotalAmount` 기능이 필요하다
- 최소 한 종류 이상의 상품을 주문해야한다 + 총 주문 금액은 각 상품의 구매 가격 하블 모두 더한 금액이다
	- Order과 OrderLine의 관계를 알 수 있다.
	- Order에는 `calculateTotalAmount` 기능이 필요하다

# 1.6 엔티티와 벨류

- 도출한 도메인 모델은 엔티티와 벨류로 구분할 수 있다.
- 엔티티의 가장 큰 특징은 식별자가 있다는 것이다.
	- 엔티티의 생성, 수정, 삭제까지 한번 생성된 식별자는 변하지 않는다.
	- 엔티티의 식별자가 같다면  동일한 엔티티로 판단. `equals()`와 `hashCode()`를 오버라이딩 할 수 있다.
- 식별자는 다음과 같은 방법으로 구할 수 있다.
	- DB에 맡기기
	- UUID
	- 특정 규칙에 따라 생성
- 벨류는 개념적으로 완전한 하나를 표현하기 위해 사용한다.
	- `ShippingInfo.class`에 `private String receiverName` 필드와 `private String receiverPhoneNumber` 필드가 존재
	- 이 필드들은 개념적으로 `수신인` 이라는 개념을 표현하는 중이므로 두 필드를 묶어 `Receiver`라는 클래스를 만들 수 있다.
		- `Receiver`는 벨류 타입이 된다.
	- 벨류 타입은 두개 이상의 필드를 사용해야만 하는 것은 아니다.
		- 개념적으로 의미를 잘 드러닐 수 있으면 하나의 필드를 사용할 수 있다.
	- 벨류 타입만의 메서드를 제공할 수 있다.
	- 벨류 타입의 값을 변경할 때는 새로운 객체를 리턴하는 방식을 사용한다.

		```java
		public class Money{
			private int price;
		
			public Money add(Money added){
				return new Money(this.price+added.price);
			}
		}
		```
		- 불변 객체로써 안전한 코드를 작성할 수 있게 된다.
		- Money가 가변객체라면 전달받은 파라미터(added)를 복사해서 사용해야한다.
		- Money가 불변 객체라면 복사할 필요 없이 바로 사용할 수 있다.

### 1.6.3 도메인 모델에 set 넣지 않기

- 프로그래밍을 하다보면 무분별하게 `get`과 `set`을 사용한다.
- 도메인 모델에 세터를 두면 단점이 생긴다!
	- 도메인 모델의 핵심 로직을 잃게 된다.
	- 도메인 모델 생성시 객체가 온전치 않은 상태로 존재할 수 있다.

> [!faq]- 도메인 모델의 핵심 로직을 잃게 된다?
> - `changeShippingInfo()`는 새로운 배송지로 변경한다는 의미를 담고 있지만 `setShippingInfo`는 단순하게 배송지를 설정하는 의미를 담는다.
> - `completePayment`는 결제 완료의 의미를 담지만 `setOrderStatus`는 단순히 상태 변경만을 나타낸다.
> - `completePayment`는 결제완료와 관련된 도메인 지식을 코드에 담는 것이 자연스럽다
> - `setOrderStatus`는 상태만 변경할지 해당 상태 변경에 따른 추가 로직이 필요할지 판단하기 어렵다. 즉 도메인 지식을 코드에 녹여내기 어렵다. 
> → `set`을 사용하면 도메인 지식을 코드에 녹여내기 어렵다.


